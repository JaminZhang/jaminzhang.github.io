---
layout: post
title: Linux 下文件删除后仍然占用空间的问题
description: "Linux 下文件删除后仍然占用空间的问题"
category: OS
avatarimg:
tags: [rm, lsof, du, df]
duoshuo: true
---


# 引言

一个朋友问在 Linux 系统下删除文件后空间还继续占用是怎么回事？
这个情况我确实没有遇到过，第一时间，我想到的是有进程占用了这个文件，具体的空间没释放的原因解释还不太清楚。
所以查了下，有人碰到这种情况，我们来看看他们的分析。

# Linux 下文件删除后仍然占用空间的问题原因分析及解决办法

<pre>

在 Linux 中，当我们使用 rm 删除了大文件，但是如果有进程打开了这个大文件，却没有关闭这个文件的句柄，
那么 Linux 内核还是不会释放这个文件的磁盘空间，最后造成磁盘空间占用 100%，整个系统无法正常运行。
这种情况下，通过 df 和 du 命令查找的磁盘空间，
两者是无法匹配的，可能 df 显示磁盘 100%，而 du 查找目录的磁盘容量占用却很小。

遇到这种情况，基本可以断定是某些大文件被某些程序占用了，并且这些大文件已经被删除了，
但是对应的文件句柄没有被某些程序关闭，造成内核无法收回这些文件占用的空间。

使用以下命令查找哪些文件被某些程序占用：
lsof -n | grep deleted
打印出所有针对已删除文件的读写操作，这类操作是无效的，也正是磁盘空间莫名消失的根本原因。

释放空间解决办法：
kill -9 PID  # 只需把对应打开文件的进程停止掉就能释放空间

</pre> 

# Ref

[处理 Linux 系统下已删除文件继续占用空间问题](http://blog.csdn.net/zhaojian1988/article/details/40376771)
